(function(){var d=[];var g=[];$(document).ready(function(){if(typeof dataLayer!=="undefined"){l()}});function l(){var n=document.getElementsByTagName("iframe");for(i=0;i<n.length;++i){var m=n[i].getAttribute("src");if(/player\.vimeo\.com\/video/.test(m)){if(!n[i].hasAttribute("id")){n[i].setAttribute("id","vimeo_id_"+i)}var o=false;if(!/api=/.test(m)){m=c(m,"api",1);o=true}if(!/player_id=/.test(m)){m=c(m,"player_id",n[i].getAttribute("id"));o=true}if(o){n[i].setAttribute("src",m)}d[n[i].getAttribute("id")]=n[i].getAttribute("src")}}if(window.addEventListener){window.addEventListener("message",b,false)}else{window.attachEvent("onmessage",b,false)}}function c(m,o,n){return m+((/\?/.test(m))?"&":"?")+o+"="+n}function b(n){if(!(/^https?:\/\/player.vimeo.com/).test(n.origin)){return false}var m=n.data;try{m=ICIMS.jsonDecode(n.data)}catch(n){}switch(m.event){case"ready":h(m);break;case"play":a(m);break;case"playProgress":f(m);break;case"pause":j(m);break}}function k(q,p){var o={method:q};if(p){o.value=p}var n=document.getElementsByTagName("iframe");var m;for(i=0;i<n.length;++i){m=window.location.protocol+n[i].getAttribute("src").split("?")[0];try{n[i].contentWindow.postMessage(ICIMS.jsonEncode(o),m)}catch(r){}}}function e(m){return d[m].split("?")[0]}function h(){k("addEventListener","play");k("addEventListener","pause");k("addEventListener","finish");k("addEventListener","playProgress")}function a(m){dataLayer.push({event:"vimeo",action:"play",label:e(m.player_id)})}function j(m){if(g[m.player_id]!=1){dataLayer.push({event:"vimeo",action:"pause",label:e(m.player_id)})}}function f(n){var m=n.data.duration-n.data.seconds<=1.5?1:(Math.floor(n.data.seconds/n.data.duration*4)/4).toFixed(2);if(!g[n.player_id]||m>g[n.player_id]){g[n.player_id]=m;dataLayer.push({event:"vimeo",action:m*100+"%",label:e(n.player_id)})}}})();